<!doctype html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Contracheques - MeuRH</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/financeiro.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<header th:replace="~{layout :: header}"></header>
<main class="container py-5">
    <h3 class="mb-4">Consulta de Contracheque Individual</h3>
    <div class="card">
        <div class="card-body">
            <form th:action="@{/financeiro/contracheques}" method="get">
                <div class="row">
                    <div class="col-md-5 mb-3">
                        <label class="form-label">Selecione o Funcionário</label>
                        <select class="form-select" name="cpf" onchange="this.form.submit()">
                            <option value="">Selecione...</option>
                            <option th:each="f : ${funcionarios}"
                                    th:value="${f.cpf}"
                                    th:text="${f.nome}"
                                    th:selected="${funcionario != null && f.cpf == funcionario.cpf}"></option>
                        </select>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label for="mes" class="form-label">Mês</label>
                        <select class="form-select" id="mes" name="mes" onchange="this.form.submit()">
                            <option th:each="m : ${#numbers.sequence(1, 12)}"
                                    th:value="${m}"
                                    th:text="${T(java.time.Month).of(m).getDisplayName(T(java.time.format.TextStyle).FULL, new java.util.Locale('pt', 'BR'))}"
                                    th:selected="${m == mesSelecionado}">
                            </option>
                        </select>
                    </div>

                    <div class="col-md-3 mb-3">
                        <label for="ano" class="form-label">Ano</label>
                        <input type="number" class="form-control" id="ano" name="ano"
                               th:value="${anoSelecionado}"
                               onchange="this.form.submit()">
                    </div>
                </div>
            </form>
            <hr>

            <div th:if="${funcionario != null}">
                <h4 class="text-center" th:text="${'Contracheque - ' + funcionario.nome}"></h4>

                <p class="text-center text-muted" th:text="${'Período: ' + periodoReferencia}"></p>

                <table class="table">
                    <thead><tr><th>Descrição</th><th>Vencimentos</th><th>Descontos</th></tr></thead>
                    <tbody>
                    <tr>
                        <td>Salário Base</td>
                        <td th:text="${'R$ ' + #numbers.formatDecimal(funcionario.baseSalario, 1, 'POINT', 2, 'COMMA')}"></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Vale-Alimentação</td>
                        <td th:text="${'R$ ' + #numbers.formatDecimal(funcionario.regraSalario.valorValeAlimentacao, 1, 'POINT', 2, 'COMMA')}"></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Vale-Transporte (Base)</td>
                        <td th:text="${'R$ ' + #numbers.formatDecimal(funcionario.regraSalario.valorValeTransporte, 1, 'POINT', 2, 'COMMA')}"></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>INSS</td>
                        <td></td>
                        <td th:text="${'R$ ' + #numbers.formatDecimal(funcionario.baseSalario * funcionario.regraSalario.percentualINSS / 100, 1, 'POINT', 2, 'COMMA')}"></td>
                    </tr>
                    <tr>
                        <td>IRRF</td>
                        <td></td>
                        <td th:text="${'R$ ' + #numbers.formatDecimal(funcionario.baseSalario * funcionario.regraSalario.percentualRRF / 100, 1, 'POINT', 2, 'COMMA')}"></td>
                    </tr>
                    <tr>
                        <td>Desconto Vale-Transporte</td>
                        <td></td>
                        <td th:text="${'R$ ' + #numbers.formatDecimal(funcionario.regraSalario.valorValeTransporte * funcionario.regraSalario.percentualDescVT / 100, 1, 'POINT', 2, 'COMMA')}"></td>
                    </tr>
                    </tbody>
                    <tfoot class="fw-bold">
                    <tr>
                        <td>TOTAIS</td>
                        <td th:text="${'R$ ' + #numbers.formatDecimal(salarioBruto, 1, 'POINT', 2, 'COMMA')}"></td>
                        <td th:text="${'R$ ' + #numbers.formatDecimal(totalDescontos, 1, 'POINT', 2, 'COMMA')}"></td>
                    </tr>
                    <tr>
                        <td colspan="2">LÍQUIDO A RECEBER</td>
                        <td th:text="${'R$ ' + #numbers.formatDecimal(salarioLiquido, 1, 'POINT', 2, 'COMMA')}"></td>
                    </tr>
                    </tfoot>
                </table>
            </div>
            <div th:if="${funcionario == null}" class="text-center p-3">
                <p>Nenhum funcionário selecionado.</p>
            </div>
        </div>
    </div>
</main>
<footer th:replace="~{layout :: footer}"></footer>
</body>
</html>