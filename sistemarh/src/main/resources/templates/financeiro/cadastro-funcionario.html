<!doctype html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Gestão de Funcionários - MeuRH</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/financeiro.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<header th:replace="~{layout :: header}"></header>
<main class="container py-5">

    <div class="card mb-5">
        <div class="card-header card-financeiro"><h4 class="mb-0">Admissão de Novo Funcionário</h4></div>
        <div class="card-body">

            <div th:if="${param.error}" class="alert alert-danger" role="alert">
                Erro ao admitir: <span th:text="${param.error}"></span>
            </div>

            <form th:action="@{/financeiro/cadastrar-funcionario/admitir}" method="post">
                <div class="mb-3">
                    <label class="form-label">Candidato Aprovado</label>
                    <select class="form-select" name="contratacaoId" required>
                        <option value="">Selecione a contratação aprovada...</option>
                        <option th:each="c : ${contratacoesAprovadas}"
                                th:value="${c.id}"
                                th:text="${c.candidato.nome + ' - Vaga: ' + c.vaga.titulo}"></option>
                    </select>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="cargo" class="form-label">Cargo</label>
                        <input type="text" class="form-control" id="cargo" name="cargo" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="departamento" class="form-label">Departamento</label>
                        <input type="text" class="form-control" id="departamento" name="departamento" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="salario" class="form-label">Salário Base (R$)</label>
                        <input type="number" step="0.01" class="form-control" id="salario" name="salario" required>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="regraSalarialId" class="form-label">Regra Salarial</label>
                        <select class="form-select" id="regraSalarialId" name="regraSalarialId" required>
                            <option value="">Selecione uma regra...</option>
                            <option th:each="r : ${regrasSalariais}"
                                    th:value="${r.id}"
                                    th:text="${r.nomeRegra}">
                            </option>
                        </select>
                    </div>
                </div>
                <hr>
                <button type="submit" class="btn btn-info text-white">Efetivar Contratação</button>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-header"><h4 class="mb-0">Atualização Cadastral de Funcionários Ativos</h4></div>
        <div class="card-body">

            <div th:if="${param.errorUpdate}" class="alert alert-danger" role="alert">
                Erro ao atualizar: <span th:text="${param.errorUpdate}"></span>
            </div>

            <div th:if="${#lists.isEmpty(funcionarios)}" class="alert alert-secondary">
                Nenhum funcionário ativo cadastrado para atualização.
            </div>

            <div class="table-responsive" th:if="${!#lists.isEmpty(funcionarios)}">
                <table class="table table-striped align-middle">
                    <thead>
                    <tr>
                        <th>Funcionário (CPF)</th>
                        <th>Cargo</th>
                        <th>Departamento</th>
                        <th>Salário Base (R$)</th>
                        <th>Regra Salarial</th>
                        <th>Ação</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="f : ${funcionarios}">
                        <form th:action="@{/financeiro/cadastrar-funcionario/atualizar}" method="post">
                            <input type="hidden" name="cpf" th:value="${f.cpf}" />

                            <td th:text="${f.nome + ' (' + f.cpf + ')'}"></td>

                            <td>
                                <input type="text" name="cargo" th:value="${f.cargo}" class="form-control form-control-sm" required>
                            </td>

                            <td>
                                <input type="text" name="departamento" th:value="${f.departamento}" class="form-control form-control-sm" required>
                            </td>

                            <td>
                                <input type="number" step="0.01" name="salario" th:value="${f.baseSalario}" class="form-control form-control-sm" required>
                            </td>

                            <td>
                                <select name="regraSalarialId" class="form-select form-select-sm" required>
                                    <option th:each="r : ${regrasSalariais}"
                                            th:value="${r.id}"
                                            th:text="${r.nomeRegra}"
                                            th:selected="${r.id == f.regraSalarialId}">
                                    </option>
                                </select>
                            </td>

                            <td>
                                <button type="submit" class="btn btn-warning btn-sm">Atualizar</button>
                            </td>
                        </form>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</main>
<footer th:replace="~{layout :: footer}"></footer>
</body>
</html>