<!doctype html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Relatório Financeiro</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/financeiro.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<header th:replace="~{layout :: header}"></header>
<main class="container py-5">

    <div th:if="${folhaProcessada == null}">
        <div class="alert alert-warning" role="alert">
            Nenhuma folha de pagamento foi processada.
            <a th:href="@{/financeiro/gerar-folha}" class="alert-link">Gere uma nova folha</a>.
        </div>
    </div>

    <div th:if="${folhaProcessada != null}">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 th:text_="|Relatório - Folha de Pagamento (${folhaProcessada.mesReferencia}/${folhaProcessada.anoReferencia})|">
                Relatório - Folha de Pagamento
            </h3>
            <div>
                <button class="btn btn-success">Exportar CSV</button>
                <button class="btn btn-danger">Exportar PDF</button>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                <tr>
                    <th>Funcionário</th>
                    <th>Cargo</th>
                    <th>Salário Base</th>
                    <th>Benefícios</th>
                    <th>Descontos</th>
                    <th>Salário Líquido</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="func : ${folhaProcessada.funcionariosProcessados}">
                    <td th:text="${func.getNome()}">Ana Silva</td>
                    <td th:text="${func.getCargo()}">Cargo</td>

                    <td th:text_="'R$ ' + ${#numbers.formatDecimal(func.baseSalario, 1, 'POINT', 2, 'COMMA')}">R$ 5.000,00</td>

                    <td th:with="beneficios=${func.regraSalario.valorValeAlimentacao + func.regraSalario.valorValeTransporte}"
                        th:text_="'R$ ' + ${#numbers.formatDecimal(beneficios, 1, 'POINT', 2, 'COMMA')}">
                        R$ 500,00
                    </td>
                    <td th:with="descontos=${(func.baseSalario * func.regraSalario.percentualINSS / 100) + (func.baseSalario * func.regraSalario.percentualRRF / 100) + (func.regraSalario.valorValeTransporte * func.regraSalario.percentualDescVT / 100)}"
                        th:text_="'R$ ' + ${#numbers.formatDecimal(descontos, 1, 'POINT', 2, 'COMMA')}">
                        R$ 1.200,00
                    </td>
                    <td th:with="liquido=${func.calcularSalario()}"
                        th:text_="'R$ ' + ${#numbers.formatDecimal(liquido, 1, 'POINT', 2, 'COMMA')}">
                        R$ 4.300,00
                    </td>
                </tr>
                </tbody>

                <tfoot class="table-group-divider fw-bold fs-5">
                <tr>
                    <td colspan="2">TOTAIS</td>
                    <td th:with="totalBase=${folhaProcessada.funcionariosProcessados.![baseSalario].sum()}"
                        th:text_="'R$ ' + ${#numbers.formatDecimal(totalBase, 1, 'POINT', 2, 'COMMA')}">
                    </td>
                    <td th:with="totalBeneficios=${folhaProcessada.valorTotalBruto - folhaProcessada.funcionariosProcessados.![baseSalario].sum()}"
                        th:text_="'R$ ' + ${#numbers.formatDecimal(totalBeneficios, 1, 'POINT', 2, 'COMMA')}">
                    </td>
                    <td th:text_="'R$ ' + ${#numbers.formatDecimal(folhaProcessada.valorTotalDescontos, 1, 'POINT', 2, 'COMMA')}"></td>
                    <td th:text_="'R$ ' + ${#numbers.formatDecimal(folhaProcessada.valorTotalLiquido, 1, 'POINT', 2, 'COMMA')}"></td>
                </tr>
                </tfoot>
            </table>
        </div>
    </div>

</main>
<footer th:replace="~{layout :: footer}"></footer>
</body>
</html>