<!doctype html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Configurar Regras - MeuRH</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/financeiro.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<header th:replace="~{layout :: header}"></header>
<main class="container py-5">
    <div class="row">
        <div class="col-md-5">
            <div class="card">
                <div class="card-header card-financeiro">
                    <h4 class="mb-0" th:text="${editMode} ? 'Editar Regra Salarial' : 'Nova Regra Salarial'"></h4>
                </div>

                <div class="card-body">
                    <form th:action="@{/financeiro/configurar-regras/salvar}" method="post" th:object="${novaRegra}">

                        <input type="hidden" th:field="*{id}" />

                        <div class="mb-3">
                            <label for="nomeRegra" class="form-label">Nome da Regra (Ex: CLT, PJ, Estágio)</label>
                            <input type="text" class="form-control" id="nomeRegra" th:field="*{nomeRegra}" required>
                        </div>

                        <h5 class="mb-3 mt-4">Benefícios</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="va" class="form-label">Valor Fixo VA (R$)</label>
                                <input type="number" step="0.01" class="form-control" id="va" th:field="*{valorValeAlimentacao}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="vt" class="form-label">Valor Fixo VT (R$)</label>
                                <input type="number" step="0.01" class="form-control" id="vt" th:field="*{valorValeTransporte}">
                            </div>
                        </div>

                        <h5 class="mb-3 mt-4">Descontos (em %)</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="descVt" class="form-label">Desconto VT (%)</label>
                                <input type="number" step="0.1" class="form-control" id="descVt" th:field="*{percentualDescVT}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="inss" class="form-label">Alíquota INSS (%)</label>
                                <input type="number" step="0.1" class="form-control" id="inss" th:field="*{percentualINSS}">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="irrf" class="form-label">Alíquota IRRF (%)</label>
                                <input type="number" step="0.1" class="form-control" id="irrf" th:field="*{percentualRRF}">
                            </div>
                        </div>
                        <hr>

                        <button type="submit" class="btn btn-info text-white"
                                th:text="${editMode} ? 'Salvar Alterações' : 'Salvar Nova Regra'">
                        </button>

                        <a th:href="@{/financeiro/configurar-regras}" class="btn btn-secondary" th:if="${editMode}">Cancelar Edição</a>
                        <a th:href="@{/financeiro}" class="btn btn-secondary" th:if="${!editMode}">Voltar</a>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-7">
            <div class="card">
                <div class="card-header"><h4 class="mb-0">Regras Salvas</h4></div>
                <div class="card-body table-responsive">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>Nome</th>
                            <th>VA (R$)</th>
                            <th>VT (R$)</th>
                            <th>INSS (%)</th>
                            <th>IRRF (%)</th>
                            <th>Ações</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:if="${#lists.isEmpty(regras)}">
                            <td colspan="6" class="text-center">Nenhuma regra salarial cadastrada.</td>
                        </tr>
                        <tr th:each="regra : ${regras}">
                            <td th:text="${regra.nomeRegra}"></td>
                            <td th:text="${#numbers.formatDecimal(regra.valorValeAlimentacao, 1, 'POINT', 2, 'COMMA')}"></td>
                            <td th:text="${#numbers.formatDecimal(regra.valorValeTransporte, 1, 'POINT', 2, 'COMMA')}"></td>
                            <td th:text="${regra.percentualINSS + '%'}"></td>
                            <td th:text="${regra.percentualRRF + '%'}"></td>
                            <td>
                                <a th:href="@{/financeiro/configurar-regras/editar/{id}(id=${regra.id})}" class="btn btn-warning btn-sm">Editar</a>

                                <a th:href="@{/financeiro/configurar-regras/excluir/{id}(id=${regra.id})}"
                                   class="btn btn-danger btn-sm"
                                   th:if="${regra.id != 1}"
                                   onclick="return confirm('Tem certeza que deseja excluir esta regra?');">Excluir</a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</main>
<footer th:replace="~{layout :: footer}"></footer>
</body>
</html>