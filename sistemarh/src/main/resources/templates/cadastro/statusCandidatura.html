<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Status da Candidatura - MeuRH</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/cadastro.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<header th:replace="~{layout :: header}"></header>

<main class="container py-5">
    <h2 class="mb-4">Status da Candidatura</h2>

    <div th:if="${param.error}" class="alert alert-danger" role="alert">
        Erro ao excluir: <span th:text="${param.error}"></span>
    </div>

    <form method="get" th:action="@{/cadastro/status}" class="row g-3 mb-4">
        <div class="col-md-3">
            <label for="vaga" class="form-label">Vaga</label>
            <select class="form-select" id="vaga" name="vagaId">
                <option value="">Todas</option>
                <option th:each="v : ${vagas}"
                        th:value="${v.id}"
                        th:text="${v.titulo}"
                        th:selected="${v.id == vagaFiltro}"></option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="status" class="form-label">Status</label>
            <select class="form-select" id="status" name="status">
                <option value="">Todos</option>
                <option value="Pendente" th:selected="${'Pendente' == statusFiltro}">Pendente</option>
                <option value="Em Análise" th:selected="${'Em Análise' == statusFiltro}">Em Análise</option>
                <option value="Aprovado" th:selected="${'Aprovado' == statusFiltro}">Aprovado</option>
                <option value="Reprovado" th:selected="${'Reprovado' == statusFiltro}">Reprovado</option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="formacao" class="form-label">Formação (Contém)</label>
            <input type="text" class="form-control" id="formacao" name="formacao" th:value="${formacaoFiltro}" />
        </div>
        <div class="col-md-3">
            <label for="experiencia" class="form-label">Experiência (Contém)</label>
            <input type="text" class="form-control" id="experiencia" name="experiencia" th:value="${experienciaFiltro}" />
        </div>
        <div class="col-12 align-self-end">
            <button type="submit" class="btn btn-primary">Filtrar</button>
            <a th:href="@{/cadastro/status}" class="btn btn-secondary">Limpar Filtros</a>
        </div>
    </form>
    <div class="card">
        <div class="card-header">
            Candidaturas Registradas
        </div>
        <div class="card-body table-responsive">
            <table class="table table-bordered table-hover">
                <thead class="table-light">
                <tr>
                    <th>Candidato</th>
                    <th>Vaga</th>
                    <th>Status</th>
                    <th>Data</th>
                    <th>Ação</th>
                </tr>
                </thead>
                <tbody>
                <tr th:if="${#lists.isEmpty(candidaturas)}">
                    <td colspan="5" class="text-center">Nenhuma candidatura registrada.</td>
                </tr>
                <tr th:each="c : ${candidaturas}">
                    <td th:text="${c.candidato != null ? c.candidato.nome : c.cpfCandidatoDoArquivo}"></td>
                    <td th:text="${c.vaga != null ? c.vaga.titulo : c.idVagaDoArquivo}"></td>
                    <td th:text="${c.status}"></td>
                    <td th:text="${#temporals.format(c.dataCandidatura, 'dd/MM/yyyy')}"></td>
                    <td>
                        <a th:href="@{/cadastro/candidatura/excluir/{id}(id=${c.id})}"
                           class="btn btn-danger btn-sm"
                           th:if="${c.status == 'Pendente'}"
                           onclick="return confirm('Tem certeza que deseja excluir esta candidatura?');">
                            Excluir
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</main>

<footer th:replace="~{layout :: footer}"></footer>
</body>
</html>